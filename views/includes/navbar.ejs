<hr class="starting-hr" />
  <header class="sticky-top">
    <nav
      class="navbar navbar-expand-md bg-body-tertiary border-bottom"
    >
      <div class="container-fluid">
        <div class="d-flex align-items-center ms-4 me-3">
          <a class="navbar-brand ms-5 me-5 ps-5 pe-5" href="/homePage">MY Auction</a>
          <div class="line"></div>
        </div>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNavAltMarkup"
          aria-controls="navbarNavAltMarkup"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div
          class="collapse navbar-collapse justify-content-center align-items-center"
          id="navbarNavAltMarkup"
        >
          <% if (!currUser) { %>
          <div class="navbar-nav">
            <a class="nav-link text-black ms-5 me-5" href="/listings">Listing</a>
            <a class="nav-link text-black ms-5 me-5" href="/auctions">Auctions</a>
            <a class="nav-link text-black ms-5 me-5" href="/listings/new">Sell Car</a>
            <a class="nav-link text-black ms-5 me-5" href="/login">Login</a>
            <a class="nav-link text-black ms-5 me-5" href="/register">Register</a>
          </div>
          <% } else { %> 
          <% if (currUser._id.equals('662e1874d4fbf3b3c0b96edb')) { %>
          <div class="navbar-nav">
            <a class="nav-link text-black ms-5 me-5" href="/admin/manageListings">Listing</a>
            <a class="nav-link text-black ms-5 me-5" href="/admin/manageUsers">User</a>
            <a class="nav-link text-black ms-5 me-5" href="/admin/manageAuctions">Auctions</a>
            <a class="nav-link text-black ms-5 me-5" href="/admin/supportCustomer">Support Customer</a>
            <li class="nav-item dropdown ms-5">
              <a
                class="nav-link dropdown-toggle text-black"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fa-solid fa-user"></i> Username
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="/admin/profile">Profile</a></li>
                <li><a class="dropdown-item" href="/logout">Logout</a></li>
              </ul>
            </li>
          </div>
          <% } else { %>
          <div class="navbar-nav">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-black ms-5"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Listing
              </a>
              <ul class="dropdown-menu ms-4">
                <li><a class="dropdown-item" href="/listings">All Listing</a></li>
                <li><a class="dropdown-item" href="/listings/watchList">My Watch List</a></li>
              </ul>
            </li>
            <a class="nav-link text-black ms-5" href="/auctions">Auctions</a>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-black ms-5"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                My Auction Center
              </a>
              <ul class="dropdown-menu dropdown-menu-center ms-5">
                <li><a class="dropdown-item" href="/auctions/bids">My Bids</a></li>
                <li><a class="dropdown-item" href="/auctions/bids/result">Auction Result</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-black ms-5"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                Sell Car
              </a>
              <ul class="dropdown-menu ms-5">
                <li><a class="dropdown-item" href="/listings/new">Add Car</a></li>
                <li><a class="dropdown-item" href="/listings/allCar">All Car</a></li>
              </ul>
            </li>
            <a class="nav-link text-black ms-5" href="/complaint">Customer Support</a>
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle text-black ms-5"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                <i class="fa-solid fa-user"></i> <%= currUser.username %>
              </a>
              <ul class="dropdown-menu ms-5">
                <li><a class="dropdown-item" href="/profile">Profile</a></li>
                <li><a class="dropdown-item" href="/logout">Logout</a></li>
              </ul>
            </li>
            <li class="nav-item dropdown">
              <a
                class="nav-link notification-icon ms-5"
                href="#"
                id="navbarDropdown"
                role="button"
                data-toggle="dropdown"
                aria-haspopup="true"
                aria-expanded="false"
              >
                <i class="fas fa-bell"></i>
                <% const unreadNotifications = userNotifications.filter(notification => !notification.isRead); %>
                <% if (unreadNotifications.length > 0) { %>
                <sup class="badge rounded-pill bg-danger"><%= unreadNotifications.length %></sup>
                <% } %>
              </a>
              <div
                id="notification-dropdown"
                class="dropdown-menu dropdown-menu-right"
                aria-labelledby="navbarDropdown"
              >
                <% if (userNotifications.length > 0) { %>
                <% userNotifications.forEach(notification => { %>
                <a
                  class="dropdown-item <%= notification.isRead ? 'read-notification' : '' %>"
                  href="<%= notification.link %>"
                  data-id="<%= notification._id %>"
                >
                  <div class="d-flex justify-content-between">
                    <span><%= notification.message %></span>
                    <span class="ms-2 fs-6 text-end"><%= notification.createdAt.toString().split(" ")[4] %></span>
                  </div>
                </a>
                <% }) %> 
                <% } else { %>
                <p class="dropdown-item">No new notifications</p>
                <% } %>
              </div>
            </li>
          </div>
          <% } %> 
          <% } %>
        </div>
      </div>
    </nav>
</header>



<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
  $(document).ready(function () {
    // Click event for notification icon
    $(".notification-icon").click(function (event) {
      event.stopPropagation(); // Prevent event from bubbling up
      $("#notification-dropdown").toggle(); // Toggle notification dropdown
    });

    // Close dropdowns when clicking outside
    $(document).click(function () {
      $("#notification-dropdown").hide();
    });
  });
</script>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const notificationLinks = document.querySelectorAll(
      ".dropdown-item[data-id]"
    );

    notificationLinks.forEach((link) => {
      link.addEventListener("click", async (event) => {
        event.preventDefault();

        const notificationId = link.getAttribute("data-id");
        const response = await fetch(`/notifications/${notificationId}/read`, {
          method: "POST",
        });

        if (response.ok) {
          link.classList.add("read-notification");
          window.location.href = link.getAttribute("href");
        } else {
          console.error("Failed to mark notification as read");
        }
      });
    });
  });
</script>
