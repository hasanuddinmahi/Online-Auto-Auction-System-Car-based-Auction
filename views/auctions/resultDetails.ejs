<% layout("/layouts/boilerplate") %>

<article>
  <section class="mt-5 mb-5">
    <div class="d-flex justify-content-around align-items-baseline">
      <div class="w-50">
        <div
          class="d-flex justify-content-between align-items-center ps-2 pe-2 pt-2 image-head"
        >
          <div><h5><%= listing.title %></h5></div>
          <div>
            <h5 class="bg-warning p-2">
              RM <%= listing.basePrice.toLocaleString("en-US") %>
            </h5>
          </div>
        </div>
        <div>
          <div id="carouselExample" class="carousel slide pb-1 mt-3">
            <div class="carousel-inner">
              <div class="carousel-item active">
                <img src="<%= listing.image[0] && listing.image[0].url ?
                listing.image[0].url : "https://bit.ly/3ubuq5o" %>"
                class="d-block w-100 image-fluid" id="mainImg" alt="..." />
              </div>
              <% for(let image of listing.image.slice(1)){ %>
              <div class="carousel-item">
                <img src="<%= image && image.url ? image.url :
                "https://bit.ly/3ubuq5o" %>" class="d-block w-100 image-fluid"
                id="mainImg" alt="..." />
              </div>
              <% } %>
            </div>
            <button
              class="carousel-control-prev"
              type="button"
              data-bs-target="#carouselExample"
              data-bs-slide="prev"
            >
              <span
                class="carousel-control-prev-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Previous</span>
            </button>
            <button
              class="carousel-control-next"
              type="button"
              data-bs-target="#carouselExample"
              data-bs-slide="next"
            >
              <span
                class="carousel-control-next-icon"
                aria-hidden="true"
              ></span>
              <span class="visually-hidden">Next</span>
            </button>
          </div>
        </div>
      </div>

      <div class="contact-box w-25">
        <div
          class="container-fluid contact-head p-3 d-flex justify-content-start align-items-center"
        >
          <div class="ms-2 contact-line"></div>
          <h6 class="ms-2 me-2 fw-semibold">CONTACT SELLER</h6>
        </div>
        <div class="p-4">
          <p>Sold By</p>
          <div class="d-flex justify-content-between mb-4">
            <div>
              <p>
                <a class="text-decoration-none" href="/auctions/seller/<%=
                listing.owner.id %>"><i class="fa-solid fa-circle-user fa-xl"></i> <%=
                listing.owner.username %>
              </p></a>
              <p>
                <i class="fa-solid fa-location-dot fa-lg"></i> <%=
                listing.owner.location %>
              </p>
              <p id="phoneNumber">
                <i class="fa-solid fa-phone fa-lg"></i> +60 <%=
                listing.owner.phoneNumber %>
              </p>
            </div>
            <div>
              <h5 class="fs-5"><i class="fa-solid fa-message"></i> Chats</h5>
            </div>
          </div>

          <button id="contactNow" class="mt-2 btn-contact w-100 fw-semibold">
            Contact Now
          </button>
        </div>
      </div>
    </div>
  </section>

  <section class="mt-5 mb-5 car-overview">
    <div class="text-center pt-4 pb-3">
      <h4>CAR OVERVIEW</h4>
      <hr class="small-hr" />
    </div>
    <hr class="ms-5 me-5" />
    <div class="d-flex justify-content-between">
      <div class="w-50 ms-5 me-5">
        <div class="d-flex justify-content-between">
          <p>fuel type</p>
          <p><%= listing.carType %></p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Seat</p>
          <p><%= listing.seat %></p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Registration Type</p>
          <p><%= listing.registrationType %></p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Spare Key</p>
          <p>No</p>
        </div>
        <hr class="mt-0" />
      </div>
      <div class="me-5 w-50 ms-5">
        <div class="d-flex justify-content-between">
          <p>fuel type</p>
          <p>petrol</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Seat</p>
          <p>4</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Registration Type</p>
          <p>Private</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Spare Key</p>
          <p>No</p>
        </div>
        <hr class="mt-0 mb-5" />
      </div>
    </div>
  </section>
  <section class="mt-5 mb-5">
    <div class="text-center pt-4 pb-3">
      <h4>CAR DETAILS</h4>
      <hr class="small-hr" />
      <p>
        Specifications shown for this model comes standard from the
        manufacturer.
      </p>
    </div>
    <hr class="ms-5 me-5" />
    <div class="d-flex justify-content-between">
      <div class="w-50 ms-5 me-5">
        <div class="d-flex justify-content-between">
          <p>fuel type</p>
          <p>petrol</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Seat</p>
          <p>4</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Registration Type</p>
          <p>Private</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Spare Key</p>
          <p>No</p>
        </div>
        <hr class="mt-0" />
      </div>
      <div class="me-5 w-50 ms-5">
        <div class="d-flex justify-content-between">
          <p>fuel type</p>
          <p>petrol</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Seat</p>
          <p>4</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Registration Type</p>
          <p>Private</p>
        </div>
        <hr class="mt-0 mb-2" />
        <div class="d-flex justify-content-between">
          <p>Spare Key</p>
          <p>No</p>
        </div>
        <hr class="mt-0 mb-5" />
      </div>
    </div>
  </section>

  <section class="m-5">
    <div class="text-center pt-4 pb-3">
      <h4>CAR OVERVIEW</h4>
      <hr class="small-hr" />
      <p>
        <%= listing.description %>elvage drinking vinegar roof party bitters
        beard wolf craft beer Blue Bottle, literally you probably haven't heard
        of them. Deep v
      </p>
    </div>

    <!-- show btns for authorized user -->
    <% if(currUser && currUser._id.equals(listing.owner._id)){ %>
    <div class="d-flex justify-content-end">
      <a href="/listings/<%= listing._id%>/edit" class="btn btn-primary">Edit</a
      ><br />

      <!-- open modal -->
      <button
        type="button"
        class="btn btn-danger ms-2"
        data-bs-toggle="modal"
        data-bs-target="#staticBackdrop"
      >
        Delete
      </button>

      <!-- Modal -->
      <div
        class="modal fade"
        id="staticBackdrop"
        data-bs-backdrop="static"
        data-bs-keyboard="false"
        tabindex="-1"
        aria-labelledby="staticBackdropLabel"
        aria-hidden="true"
      >
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h1 class="modal-title fs-5" id="staticBackdropLabel">
                Confirmation
              </h1>
              <button
                type="button"
                class="btn-close"
                data-bs-dismiss="modal"
                aria-label="Close"
              ></button>
            </div>
            <div class="modal-body">Are you sure to delete?</div>
            <div class="modal-footer">
              <button
                type="button"
                class="btn btn-secondary"
                data-bs-dismiss="modal"
              >
                Close
              </button>
              <form
                method="POST"
                action="/listings/<%= listing._id %>?_method=DELETE"
              >
                <button class="btn btn-danger">Confirm</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% } %>
  </section>

  <section class="m-5 rating-box rounded">
    <div class="p-3 offset-3">
      <% if (listing.review) { %>
        <h4>Review</h4>
        <p>@<%= listing.review.author.username %></p>
        <p>Comment: <%= listing.review.comment %></p>
        <p class="starability-result" data-rating="<%= listing.review.rating %>">
          Rated: <%= listing.review.rating %> stars
        </p>
      <% } else { %>
        <form
          method="POST"
          action="/auctions/bids/result/<%= listing.id %>/review"
          class="needs-validation"
          novalidate
        >
          <h3 class="mt-3 mb-3 fs-5 fw-bold offset-3">PROVIDE RATINGS</h3>
          <fieldset class="starability-slot offset-3">
            <input
              type="radio"
              id="no-rate"
              class="input-no-rate"
              name="review[rating]"
              value="0"
              checked
              aria-label="No rating."
            />
            <input
              type="radio"
              id="first-rate1"
              name="review[rating]"
              value="1"
            />
            <label for="first-rate1" title="Terrible">1 star</label>
            <input
              type="radio"
              id="first-rate2"
              name="review[rating]"
              value="2"
            />
            <label for="first-rate2" title="Not good">2 stars</label>
            <input
              type="radio"
              id="first-rate3"
              name="review[rating]"
              value="3"
            />
            <label for="first-rate3" title="Average">3 stars</label>
            <input
              type="radio"
              id="first-rate4"
              name="review[rating]"
              value="4"
            />
            <label for="first-rate4" title="Very good">4 stars</label>
            <input
              type="radio"
              id="first-rate5"
              name="review[rating]"
              value="5"
            />
            <label for="first-rate5" title="Amazing">5 stars</label>
          </fieldset>
          <textarea
            name="review[comment]"
            placeholder="ex.. write something about seller & car"
            class="mt-3 p-2 border border-black rounded"
            id=""
            cols="100"
            rows="10"
            required
          ></textarea>
          <div class="invalid-feedback">Please add some comments for review</div>
          <br />
          <button class="btn btn-primary mt-2 me-2 ps-3 pe-3 fs-6 fw-medium mb-3">
            Submit
          </button>
          <button
            class="btn btn-light border border-black mt-2 ps-3 pe-3 fs-6 fw-medium mb-3"
          >
            Cancel
          </button>
        </form>
      <% } %>
    </div>
    
  </section>
</article>

<script>
  document.getElementById("contactNow").addEventListener("click", function () {
    const phoneNumber = document
      .getElementById("phoneNumber")
      .textContent.trim();
    window.location.href = `tel:${phoneNumber}`;
  });
</script>
